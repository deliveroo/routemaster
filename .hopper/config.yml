version: '1'

container_defaults: &container_defaults
  cpu: 1024
  memory: 1024
  essential: true

web_defaults: &web_defaults
  <<: *container_defaults
  command: "bundle exec dotenv puma -I . -p 8000 -C config/puma.rb"

worker_defaults: &worker_defaults
  <<: *container_defaults
  command: "bundle exec dotenv bin/worker"

services:
  elasticache3-public-web:
    containerDefinitions:
      elasticache3-public-web:
        <<: *web_defaults
        environment:
          - name: REDIS_ENV_KEY
            value: ROUTEMASTER_REDIS_URL

  elasticache3-internal:
    containerDefinitions:
      elasticache3-internal:
        <<: *web_defaults
        environment:
          - name: REDIS_ENV_KEY
            value: ROUTEMASTER_REDIS_URL

  elasticache3-worker:
    containerDefinitions:
      elasticache3-worker:
        <<: *worker_defaults
        environment:
          - name: REDIS_ENV_KEY
            value: ROUTEMASTER_REDIS_URL

  rl-public-web:
    containerDefinitions:
      rl-public-web:
        <<: *web_defaults
        environment:
          - name: REDIS_ENV_KEY
            value: RIDER_LOCATIONS_ROUTEMASTER_REDIS_URL

  rl-internal:
    containerDefinitions:
      rl-internal:
        <<: *web_defaults
        environment:
          - name: REDIS_ENV_KEY
            value: RIDER_LOCATIONS_ROUTEMASTER_REDIS_URL

  rl-worker:
    containerDefinitions:
      rl-worker:
        <<: *worker_defaults
        environment:
          - name: REDIS_ENV_KEY
            value: RIDER_LOCATIONS_ROUTEMASTER_REDIS_URL
